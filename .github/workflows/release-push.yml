# SPDX-License-Identifier: Apache-2.0
# Copyright 2023 Canonical Ltd.
# Copyright 2024 Intel Corporation

name: Release Push Image Workflow

on:
  workflow_dispatch:

jobs:
  docker-build-push-images:
    runs-on: ubuntu-latest

    env:
      REGISTRY: docker.io
      DOCKER_REGISTRY: docker.io/
      DOCKER_REPOSITORY: cdac5gc/
      RELEASE_VERSION: 0.0.4
    
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-go@v5
        with:
          go-version-file: 'go.mod'

      - uses: docker/login-action@v3.1.0
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ secrets.DCKRUSER }}
          password: ${{ secrets.DCKRPASS }}

      - name: Build and push release Docker image
        env:
          DOCKER_TAG: release-haswell-${{ env.RELEASE_VERSION }}
          CPU: haswell
        run: |
          CPU=$CPU make docker-build
          make docker-push

      - name: Build and push release Docker image for Ivybridge CPU
        env:
          DOCKER_TAG: release-ivybridge-${{ env.RELEASE_VERSION }}
          CPU: ivybridge
        run: |
          CPU=$CPU make docker-build
          make docker-push